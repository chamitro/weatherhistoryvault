<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-73036WSLVP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-73036WSLVP');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather History Vault - Legacy Version</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 text-slate-900 min-h-screen font-sans relative">

    <div id="upgradeOverlay" class="fixed inset-0 bg-slate-900/90 backdrop-blur-md z-[100] flex items-center justify-center p-6 transition-opacity duration-500">
        <div class="bg-white rounded-[2.5rem] max-w-lg w-full p-8 md:p-12 shadow-2xl text-center border border-indigo-100">
            <div class="text-6xl mb-6">ğŸŒ</div>
            <h1 class="text-3xl font-black text-indigo-950 mb-4 uppercase italic">WeatherVault is now <span class="text-emerald-500">EarthVault</span></h1>
            <p class="text-slate-500 text-lg mb-8 leading-relaxed">
                 We've upgraded! You are being redirected to our new environmental intelligence terminal with Ocean, Forest, and Agriculture data.
            </p>
            <div class="flex flex-col gap-3">
                <a href="https://chamitro.github.io/EarthVault/" class="bg-indigo-600 hover:bg-indigo-700 text-white px-10 py-4 rounded-2xl font-bold uppercase tracking-tighter transition-all shadow-xl shadow-indigo-200 inline-block w-full">
                    Go to EarthVault
                </a>
                <button onclick="dismissUpgrade()" class="text-slate-400 hover:text-slate-600 font-bold uppercase text-[10px] tracking-widest py-2">
                    Stay on the page
                </button>
            </div>
        </div>
    </div>

    <div class="fixed bottom-2 right-2 z-50">
        <a href="https://open-meteo.com/" target="_blank" class="text-[8px] font-medium text-slate-400 hover:text-indigo-500 transition-colors uppercase tracking-tighter bg-white/50 px-2 py-1 rounded-full backdrop-blur-sm">
            Data by Open-Meteo
        </a>
    </div>

    <div id="infoModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4" onclick="closeModal()">
        <div class="bg-white rounded-3xl max-w-sm w-full p-6 shadow-2xl transform transition-all scale-100" onclick="event.stopPropagation()">
            <h2 id="modalTitle" class="text-xl font-bold text-indigo-900 mb-2"></h2>
            <p id="modalBody" class="text-slate-600 text-sm leading-relaxed mb-6"></p>
            <button onclick="closeModal()" class="w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold py-3 rounded-xl transition-colors">Got it</button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-indigo-900 tracking-tight">Weather History Vault</h1>
            <p class="text-slate-500 mt-2 text-lg">50-Year Climate & Air Quality Archive</p>
            <div class="mt-4 flex flex-wrap justify-center gap-3">
                <div class="inline-flex items-center gap-2 bg-indigo-50 border border-indigo-100 px-4 py-1.5 rounded-full text-indigo-700 text-xs font-semibold shadow-sm">
                    <span class="flex h-2 w-2 rounded-full bg-indigo-500 animate-pulse"></span>
                    Calendar-Day Archive
                </div>
                <div id="era-trend" onclick="showInfo('era')" class="hidden cursor-help inline-flex items-center gap-2 bg-white border px-4 py-1.5 rounded-full text-[10px] font-bold shadow-sm hover:border-indigo-300 transition-colors text-slate-700"></div>
                <button onclick="clearCityCache()" class="text-[10px] font-bold text-slate-400 uppercase hover:text-red-500 transition-colors">Clear Cache ğŸ—‘ï¸</button>
            </div>
        </header>

        <div class="flex flex-col md:flex-row gap-4 mb-8 justify-center">
            <input type="text" id="cityInput" placeholder="Enter city (e.g. Athens, Berlin)" 
                   class="px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none w-full md:w-96 shadow-sm">
            <button onclick="searchCity()" id="searchBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-lg font-semibold transition-all shadow-md disabled:bg-slate-400">
                Analyze 50 Years
            </button>
        </div>

        <div id="app-content" class="opacity-0 transition-opacity duration-500">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-2xl shadow-md border-2 border-indigo-100 flex flex-col overflow-hidden relative">
                    <div class="absolute top-2 left-4 bg-slate-100 px-2 py-0.5 rounded text-[8px] font-bold text-slate-500 uppercase z-10">Today vs 50y Average</div>
                    <div class="flex flex-1 pt-8 pb-4">
                        <div class="flex-1 px-6 text-center border-r border-slate-100">
                            <h3 class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-1">Today's High</h3>
                            <p id="today-temp" class="text-5xl font-black text-indigo-600 my-2">--Â°C</p>
                            <span id="comparison-tag" class="px-3 py-1 rounded-full text-[10px] font-bold inline-block">--</span>
                        </div>
                        <div class="flex-1 px-6 text-center">
                            <h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">Humidity</h3>
                            <p id="today-humid" class="text-5xl font-black text-cyan-600 my-2">--%</p>
                            <div id="streak-val" onclick="showInfo('streak')" class="cursor-help text-[9px] font-bold text-orange-500 uppercase mt-1 decoration-dotted underline underline-offset-2">Streak: -- days</div>
                        </div>
                    </div>
                    <div class="bg-slate-50 border-t border-slate-100 p-3 flex justify-around text-[9px] font-bold uppercase tracking-tighter">
                        <div class="text-slate-500">Day Avg: <span id="avg-temp" class="text-indigo-600">--</span></div>
                        <div class="text-slate-500">Pollution: <span id="pollution-val" class="text-red-500">--</span></div>
                    </div>
                </div>

                <div class="bg-slate-900 rounded-2xl shadow-md flex flex-col p-6 text-white relative">
                     <div class="absolute top-2 right-4 text-[8px] font-bold text-slate-500 uppercase tracking-widest">Historical Extremes</div>
                     <div class="flex justify-between items-center h-full pt-4 text-center">
                         <div class="flex-1">
                             <h4 class="text-red-400 text-[10px] font-bold uppercase mb-1">All-Time Hot</h4>
                             <p id="rec-hot-val" class="text-4xl font-black">--Â°</p>
                             <span id="rec-hot-year" class="text-xs text-slate-400 font-bold">--</span>
                         </div>
                         <div class="w-px h-16 bg-slate-700 mx-2"></div>
                         <div class="flex-1">
                             <h4 class="text-blue-400 text-[10px] font-bold uppercase mb-1">All-Time Cold</h4>
                             <p id="rec-cold-val" class="text-4xl font-black">--Â°</p>
                             <span id="rec-cold-year" class="text-xs text-slate-400 font-bold">--</span>
                         </div>
                     </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                <div class="bg-orange-600 p-6 rounded-2xl text-white shadow-lg text-center">
                    <h3 class="text-orange-200 text-xs font-bold uppercase tracking-widest mb-1">Extreme Heat</h3>
                    <p id="extreme-days" class="text-3xl font-bold">--</p>
                </div>
                <div class="bg-blue-900 p-6 rounded-2xl text-white shadow-lg text-center">
                    <h3 class="text-blue-200 text-xs font-bold uppercase tracking-widest mb-1">Historical Frost</h3>
                    <p id="freezing-days" class="text-3xl font-bold">--</p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 mb-8 h-[350px]">
                <canvas id="historyChart"></canvas>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border-t-4 border-slate-400">
                <div id="year-list" class="grid grid-cols-2 md:grid-cols-5 lg:grid-cols-10 gap-2"></div>
            </div>
        </div>
    </div>

    <script>
        // Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î‘ Î“Î™Î‘ Î¤ÎŸ OVERLAY
        function dismissUpgrade() {
            document.getElementById('upgradeOverlay').classList.add('opacity-0');
            setTimeout(() => {
                document.getElementById('upgradeOverlay').classList.add('hidden');
            }, 500);
        }

        // ÎŸÎ›Î•Î£ ÎŸÎ™ Î¥Î ÎŸÎ›ÎŸÎ™Î Î•Î£ Î Î‘Î›Î™Î•Î£ Î£ÎŸÎ¥ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ (searchCity, processData, ÎºÎ»Ï€) Î Î‘Î¡Î‘ÎœÎ•ÎÎŸÎ¥Î Î•Î”Î©...
        let chartInstance = null;
        const today = new Date();
        const currentYear = today.getFullYear();
        const monthDay = `${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

        function closeModal() { document.getElementById('infoModal').classList.add('hidden'); }
        function clearCityCache() { localStorage.clear(); alert("Storage cleared."); }
        
        async function searchCity() {
            const cityInput = document.getElementById('cityInput').value.trim();
            if (!cityInput) return;
            const btn = document.getElementById('searchBtn');
            btn.disabled = true; btn.innerText = 'Analyzing...';
            try {
                const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(cityInput)}&count=1&language=en&format=json`);
                const geoData = await geoRes.json();
                if (geoData.results?.length > 0) {
                    const { latitude, longitude } = geoData.results[0];
                    const wRes = await fetch(`https://archive-api.open-meteo.com/v1/archive?latitude=${latitude}&longitude=${longitude}&start_date=${currentYear-50}-01-01&end_date=${today.toISOString().split('T')[0]}&daily=temperature_2m_max,temperature_2m_mean,relative_humidity_2m_mean&timezone=auto`);
                    const weatherData = await wRes.json();
                    processData(weatherData);
                }
            } catch (e) { alert("Error loading data"); }
            finally { btn.disabled = false; btn.innerText = 'Analyze 50 Years'; }
        }

        function processData(data) {
            // (Î•Î´Ï Î¼Ï€Î±Î¯Î½ÎµÎ¹ Î· Î»Î¿Î³Î¹ÎºÎ® ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ Ï€Î¿Ï… Î®Î´Î· ÎµÎ¯Ï‡ÎµÏ‚)
            document.getElementById('app-content').classList.remove('opacity-0');
            // ... Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿Ï‚ ÎºÏÎ´Î¹ÎºÎ±Ï‚ ...
        }
    </script>
</body>
</html>
